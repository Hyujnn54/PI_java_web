package Controllers;

import Models.Role;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.layout.StackPane;
import javafx.stage.Stage;
import utils.Session;

public class MainShellController {

    @FXML private StackPane contentArea;

    // top bar
    @FXML private Label lblUserName;
    @FXML private Label lblUserRole;

    // sidebar
    @FXML private Button btnInterviews;
    @FXML private Button btnApplications;
    @FXML private Button btnJobOffers;
    @FXML private Button btnDashboard; // only for admin (in your fxml visible=false managed=false)

    @FXML
    public void initialize() {
        Role role = Session.getRole();

        // show user info
        lblUserName.setText(Session.getEmail() != null ? Session.getEmail() : "User");
        lblUserRole.setText(role != null ? role.name() : "UNKNOWN");

        // show admin-only button
        boolean isAdmin = role == Role.ADMIN;
        btnDashboard.setVisible(isAdmin);
        btnDashboard.setManaged(isAdmin);

        // default page per role
        if (role == Role.ADMIN) {
            loadContent("/AdminDashboard.fxml");
        } else if (role == Role.RECRUITER) {
            loadContent("/RecruiterDashboard.fxml");
        } else if (role == Role.CANDIDATE) {
            loadContent("/CandidateDashboard.fxml");
        } else {
            loadContent("/CandidateDashboard.fxml"); // fallback
        }
    }

    private void loadContent(String fxml) {
        try {
            FXMLLoader loader = new FXMLLoader(getClass().getResource(fxml));
            Node node = loader.load();
            contentArea.getChildren().setAll(node);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ===== Top bar actions =====
    @FXML private void handleNotifications() {
        System.out.println("Notifications clicked");
    }

    @FXML private void handleUserProfile() {
        System.out.println("Profile clicked");
    }

    // your FXML uses handleDisconnect
    @FXML
    private void handleDisconnect() {
        logoutToLogin();
    }

    // ===== Sidebar navigation =====
    @FXML private void handleInterviewsNav() {
        // You can create Interviews.fxml later
        // For now route by role
        Role role = Session.getRole();
        if (role == Role.RECRUITER) loadContent("/RecruiterInterviews.fxml");
        else if (role == Role.CANDIDATE) loadContent("/CandidateInterviews.fxml");
        else loadContent("/AdminDashboard.fxml");
    }

    @FXML private void handleApplicationsNav() {
        Role role = Session.getRole();
        if (role == Role.RECRUITER) loadContent("/RecruiterApplications.fxml");
        else if (role == Role.CANDIDATE) loadContent("/CandidateApplications.fxml");
        else loadContent("/AdminDashboard.fxml");
    }

    @FXML private void handleJobOffersNav() {
        Role role = Session.getRole();
        if (role == Role.RECRUITER) loadContent("/RecruiterJobOffers.fxml");
        else if (role == Role.CANDIDATE) loadContent("/CandidateJobOffers.fxml");
        else loadContent("/AdminDashboard.fxml");
    }

    @FXML private void handleDashboardNav() {
        loadContent("/AdminDashboard.fxml");
    }

    @FXML
    private void handleFullscreenToggle() {
        try {
            Stage stage = (Stage) contentArea.getScene().getWindow();
            stage.setFullScreen(!stage.isFullScreen());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ===== Logout (bulletproof) =====
    private void logoutToLogin() {
        try {
            Session.clear();
            FXMLLoader loader = new FXMLLoader(getClass().getResource("/Login.fxml"));
            contentArea.getScene().setRoot(loader.load());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
