package Controllers;

import Models.Admin;
import Models.Candidate;
import Models.Recruiter;
import Models.User;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.scene.Node;
import javafx.scene.control.Button;
import javafx.scene.control.Label;
import javafx.scene.layout.StackPane;
import javafx.stage.Stage;
import utils.Session;

public class MainShellController {

    @FXML private StackPane contentArea;

    // top bar
    @FXML private Label lblUserName;
    @FXML private Label lblUserRole;

    // sidebar
    @FXML private Button btnInterviews;
    @FXML private Button btnApplications;
    @FXML private Button btnJobOffers;
    @FXML private Button btnDashboard; // admin only

    @FXML
    public void initialize() {
        User u = Session.getCurrentUser();

        lblUserName.setText(u != null && u.getEmail() != null ? u.getEmail() : "User");
        lblUserRole.setText(getRoleLabel(u));

        boolean isAdmin = (u instanceof Admin);
        btnDashboard.setVisible(isAdmin);
        btnDashboard.setManaged(isAdmin);

        if (u instanceof Admin) {
            loadContent("/AdminDashboard.fxml");
        } else if (u instanceof Recruiter) {
            loadContent("/RecruiterDashboard.fxml");
        } else if (u instanceof Candidate) {
            loadContent("/CandidateDashboard.fxml");
        } else {
            loadContent("/CandidateDashboard.fxml");
        }
    }

    private String getRoleLabel(User u) {
        if (u instanceof Admin) return "ADMIN";
        if (u instanceof Recruiter) return "RECRUITER";
        if (u instanceof Candidate) return "CANDIDATE";
        return "USER";
    }

    private void loadContent(String fxml) {
        try {
            FXMLLoader loader = new FXMLLoader(getClass().getResource(fxml));
            Node node = loader.load();
            contentArea.getChildren().setAll(node);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    // ===== Top bar actions =====
    @FXML private void handleNotifications() {
        System.out.println("Notifications clicked");
    }

    @FXML
    private void handleUserProfile() {
        loadContent("/Profile.fxml");
    }

    @FXML
    private void handleDisconnect() {
        logoutToLogin();
    }

    // ===== Sidebar navigation =====
    @FXML
    private void handleInterviewsNav() {
        User u = Session.getCurrentUser();
        if (u instanceof Recruiter) loadContent("/RecruiterInterviews.fxml");
        else if (u instanceof Candidate) loadContent("/CandidateInterviews.fxml");
        else if (u instanceof Admin) loadContent("/AdminDashboard.fxml");
        else loadContent("/CandidateDashboard.fxml");
    }

    @FXML
    private void handleApplicationsNav() {
        User u = Session.getCurrentUser();
        if (u instanceof Recruiter) loadContent("/RecruiterApplications.fxml");
        else if (u instanceof Candidate) loadContent("/CandidateApplications.fxml");
        else if (u instanceof Admin) loadContent("/AdminDashboard.fxml");
        else loadContent("/CandidateDashboard.fxml");
    }

    @FXML
    private void handleJobOffersNav() {
        User u = Session.getCurrentUser();
        if (u instanceof Recruiter) loadContent("/RecruiterJobOffers.fxml");
        else if (u instanceof Candidate) loadContent("/CandidateJobOffers.fxml");
        else if (u instanceof Admin) loadContent("/AdminDashboard.fxml");
        else loadContent("/CandidateDashboard.fxml");
    }

    @FXML
    private void handleDashboardNav() {
        loadContent("/AdminDashboard.fxml");
    }

    @FXML
    private void handleFullscreenToggle() {
        try {
            Stage stage = (Stage) contentArea.getScene().getWindow();
            stage.setFullScreen(!stage.isFullScreen());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    private void logoutToLogin() {
        try {
            Session.clear();
            FXMLLoader loader = new FXMLLoader(getClass().getResource("/Login.fxml"));
            contentArea.getScene().setRoot(loader.load());
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}