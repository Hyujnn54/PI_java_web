package Services;

import Models.User;
import utils.MyDatabase;

import java.sql.*;

public class UserService {
    private final Connection cnx = MyDatabase.getInstance().getConnection();

    public long addUser(User u) throws SQLException {
        String sql = "INSERT INTO users (email, password, role, first_name, last_name, phone) VALUES (?,?,?,?,?,?)";
        try (PreparedStatement ps = cnx.prepareStatement(sql, Statement.RETURN_GENERATED_KEYS)) {
            ps.setString(1, u.getEmail());
            ps.setString(2, u.getPassword());
            ps.setString(3, u.getRole().name());
            ps.setString(4, u.getFirstName());
            ps.setString(5, u.getLastName());
            ps.setString(6, u.getPhoneNumber());

            ps.executeUpdate();

            try (ResultSet rs = ps.getGeneratedKeys()) {
                if (rs.next()) return rs.getLong(1);
            }
        }
        throw new SQLException("Failed to get generated user id.");
    }
}
