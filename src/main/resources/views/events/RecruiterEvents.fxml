<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.FlowPane?>

<BorderPane xmlns="http://javafx.com/javafx/8.0.171"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="Controllers.events.RecruiterDashboardController"
            style="-fx-background-color:#F0F4FA;">
    <center>
        <StackPane>

            <!-- VIEW 1: EVENTS LIST + FORM -->
            <VBox fx:id="eventsView" spacing="20">
                <padding><Insets top="24" right="28" bottom="20" left="28"/></padding>
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <Label text="ðŸ“…  Mes Ã‰vÃ©nements" style="-fx-font-size:22px; -fx-font-weight:700; -fx-text-fill:#1E293B;"/>
                    <Pane HBox.hgrow="ALWAYS"/>
                    <Button text="â†»  Actualiser" onAction="#goToEvents"
                            style="-fx-background-color:#EBF3FF; -fx-text-fill:#1565C0; -fx-font-weight:600; -fx-background-radius:8; -fx-padding:8 16; -fx-cursor:hand; -fx-border-color:#BBDEFB; -fx-border-width:1; -fx-border-radius:8;"/>
                    <Button text="ðŸ‘¥  Inscriptions" onAction="#goToInterviews"
                            style="-fx-background-color:#F8FAFF; -fx-text-fill:#475569; -fx-background-radius:8; -fx-padding:8 16; -fx-cursor:hand; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-border-radius:8;"/>
                </HBox>

                <!-- Search + Filter bar -->
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <TextField fx:id="recruiterSearchField"
                               promptText="ðŸ”  Rechercher par titre..."
                               onKeyReleased="#handleRecruiterSearch"
                               HBox.hgrow="ALWAYS"
                               style="-fx-background-color: white; -fx-background-radius: 10;
                                      -fx-border-color: #E4EBF5; -fx-border-width: 1; -fx-border-radius: 10;
                                      -fx-padding: 10 14; -fx-font-size: 13px;"/>
                    <ComboBox fx:id="recruiterTypeFilter"
                              promptText="Tous les types"
                              onAction="#handleRecruiterSearch"
                              prefWidth="170"
                              style="-fx-background-color: white; -fx-background-radius: 10;
                                     -fx-border-color: #E4EBF5; -fx-border-width: 1; -fx-border-radius: 10;
                                     -fx-padding: 6 10; -fx-font-size: 13px;"/>
                </HBox>

                <ScrollPane fitToHeight="true" minHeight="250" prefHeight="280" hbarPolicy="AS_NEEDED" vbarPolicy="NEVER"
                            style="-fx-background-color:transparent; -fx-background:transparent; -fx-border-color:transparent;" VBox.vgrow="ALWAYS">
                    <content>
                        <HBox fx:id="eventsHBox" spacing="18" style="-fx-padding:8 4 12 4;"/>
                    </content>
                </ScrollPane>

                <!-- Form card -->
                <VBox spacing="12" style="-fx-background-color:white; -fx-background-radius:14; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-border-radius:14; -fx-padding:20 24; -fx-effect:dropshadow(gaussian,rgba(100,150,220,0.08),10,0,0,2);">
                    <Label text="CrÃ©er / Modifier un Ã©vÃ©nement" style="-fx-font-size:15px; -fx-font-weight:700; -fx-text-fill:#1E293B;"/>
                    <HBox spacing="12" alignment="CENTER_LEFT">
                        <VBox HBox.hgrow="ALWAYS" spacing="3">
                            <TextField fx:id="titleField" promptText="Titre" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-padding:8 12; -fx-font-size:13px;"/>
                            <Label fx:id="titleErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                        </VBox>
                        <VBox spacing="3">
                            <ComboBox fx:id="typeCombo" prefWidth="170" promptText="Type" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-font-size:13px;"/>
                            <Label fx:id="typeErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                        </VBox>
                    </HBox>
                    <HBox spacing="12">
                        <VBox HBox.hgrow="ALWAYS" spacing="3">
                            <HBox spacing="5" alignment="CENTER_LEFT">
                                <TextField fx:id="locationField" promptText="Lieu" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-padding:8 12; -fx-font-size:13px;" HBox.hgrow="ALWAYS" />
                                <Button text="ðŸ—ºï¸ Carte" onAction="#handlePickLocation" style="-fx-background-color:#2196F3; -fx-text-fill:white; -fx-padding:6 10; -fx-background-radius:6; -fx-cursor:hand;" />
                            </HBox>
                            <Label fx:id="locationErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                        </VBox>
                        <VBox spacing="3">
                            <DatePicker fx:id="dateField" promptText="Date" onAction="#handleDateValidation" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-font-size:13px;"/>
                            <Label fx:id="dateErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                        </VBox>
                        <VBox spacing="3">
                            <TextField fx:id="capacityField" prefWidth="110" promptText="CapacitÃ©" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-padding:8 12; -fx-font-size:13px;"/>
                            <Label fx:id="capacityErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                        </VBox>
                    </HBox>
                    <VBox spacing="3">
                        <TextField fx:id="meetLinkField" promptText="ðŸ”—  Lien de rÃ©union en ligne (ex: https://meet.google.com/...)" visible="false" managed="false" style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-padding:8 12; -fx-font-size:13px;"/>
                        <Label fx:id="meetLinkErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="false" visible="false" minHeight="0"/>
                    </VBox>
                    <VBox spacing="3">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="Description de l'Ã©vÃ©nement" style="-fx-font-size:13px; -fx-font-weight:600; -fx-text-fill:#334155;"/>
                            <Pane HBox.hgrow="ALWAYS"/>
                            <Button text="âœ¨ AutocomplÃ©tion IA" onAction="#handleGenerateDescriptionAI" style="-fx-background-color:#6f42c1; -fx-text-fill:white; -fx-font-size:11px; -fx-padding:6 12; -fx-background-radius:6; -fx-cursor:hand;"/>
                        </HBox>
                        <TextArea fx:id="descriptionField" prefHeight="140" promptText="Description..." style="-fx-background-radius:8; -fx-border-radius:8; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-font-size:13px; -fx-padding:8 12;" wrapText="true"/>
                        <Label fx:id="descriptionErrorLabel" style="-fx-font-size:11px; -fx-text-fill:#DC2626;" managed="true" minHeight="0"/>
                    </VBox>
                    <HBox spacing="10" alignment="CENTER_RIGHT">
                        <Button onAction="#handleClear" text="Vider" style="-fx-background-color:#F1F5F9; -fx-text-fill:#475569; -fx-background-radius:8; -fx-padding:8 16; -fx-cursor:hand;"/>
                        <Pane HBox.hgrow="ALWAYS"/>
                        <Button onAction="#handleDelete" text="Supprimer" style="-fx-background-color:#FEF2F2; -fx-text-fill:#DC2626; -fx-font-weight:600; -fx-background-radius:8; -fx-border-color:#FECACA; -fx-border-width:1; -fx-border-radius:8; -fx-padding:8 16; -fx-cursor:hand;"/>
                        <Button onAction="#handleUpdate" text="âœ  Modifier" style="-fx-background-color:#FFF7ED; -fx-text-fill:#C2410C; -fx-font-weight:600; -fx-background-radius:8; -fx-border-color:#FED7AA; -fx-border-width:1; -fx-border-radius:8; -fx-padding:8 16; -fx-cursor:hand;"/>
                        <Button onAction="#handleAdd" text="âœš  Ajouter" style="-fx-background-color:#1565C0; -fx-text-fill:white; -fx-font-weight:700; -fx-background-radius:8; -fx-padding:8 20; -fx-cursor:hand;"/>
                    </HBox>
                </VBox>
            </VBox>

            <!-- VIEW 2: REGISTRATIONS / ATTENDEES -->
            <VBox fx:id="interviewsView" spacing="20" visible="false" managed="false">
                <padding><Insets top="24" right="28" bottom="20" left="28"/></padding>
                <HBox alignment="CENTER_LEFT" spacing="12">
                    <Label text="ðŸ‘¥  Candidats inscrits" style="-fx-font-size:22px; -fx-font-weight:700; -fx-text-fill:#1E293B;"/>
                    <Pane HBox.hgrow="ALWAYS"/>
                    <Button text="â†»  Actualiser" onAction="#goToInterviews"
                            style="-fx-background-color:#EBF3FF; -fx-text-fill:#1565C0; -fx-font-weight:600; -fx-background-radius:8; -fx-padding:8 16; -fx-cursor:hand; -fx-border-color:#BBDEFB; -fx-border-width:1; -fx-border-radius:8;"/>
                    <Button text="â†  Retour aux Ã©vÃ©nements" onAction="#goToEvents"
                            style="-fx-background-color:#F8FAFF; -fx-text-fill:#475569; -fx-background-radius:8; -fx-padding:8 16; -fx-cursor:hand; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-border-radius:8;"/>
                </HBox>

                <!-- Live Statistics Dashboard -->
                <HBox fx:id="statsContainer" spacing="20.0" style="-fx-padding: 0 0 15 0;">
                    <children>
                        <VBox style="-fx-background-color: #EBF3FE; -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #5BA3F5; -fx-border-width: 1.5; -fx-border-radius: 12;" HBox.hgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Label fx:id="totalStatsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: 700; -fx-text-fill: #1565C0;" />
                                    <Label text="Total Postulants" style="-fx-font-size: 13px; -fx-text-fill: #475569;" />
                                </VBox>
                                <Label text="ðŸ‘¥" style="-fx-font-size: 24px;" />
                            </HBox>
                        </VBox>
                        <VBox style="-fx-background-color: #E8F5E9; -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #4CAF50; -fx-border-width: 1.5; -fx-border-radius: 12;" HBox.hgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Label fx:id="confirmedStatsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: 700; -fx-text-fill: #2E7D32;" />
                                    <Label text="ConfirmÃ©s" style="-fx-font-size: 13px; -fx-text-fill: #475569;" />
                                </VBox>
                                <Label text="âœ…" style="-fx-font-size: 24px;" />
                            </HBox>
                        </VBox>
                        <VBox style="-fx-background-color: #FFF8E1; -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #FFC107; -fx-border-width: 1.5; -fx-border-radius: 12;" HBox.hgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Label fx:id="pendingStatsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: 700; -fx-text-fill: #FF8F00;" />
                                    <Label text="En Attente" style="-fx-font-size: 13px; -fx-text-fill: #475569;" />
                                </VBox>
                                <Label text="â³" style="-fx-font-size: 24px;" />
                            </HBox>
                        </VBox>
                        <VBox style="-fx-background-color: #FFEBEE; -fx-background-radius: 12; -fx-padding: 15; -fx-border-color: #F44336; -fx-border-width: 1.5; -fx-border-radius: 12;" HBox.hgrow="ALWAYS">
                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                    <Label fx:id="cancelledStatsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: 700; -fx-text-fill: #C62828;" />
                                    <Label text="AnnulÃ©s" style="-fx-font-size: 13px; -fx-text-fill: #475569;" />
                                </VBox>
                                <Label text="âŒ" style="-fx-font-size: 24px;" />
                            </HBox>
                        </VBox>
                    </children>
                </HBox>

                <TableView fx:id="attendeesTable" VBox.vgrow="ALWAYS"
                           style="-fx-background-color:white; -fx-background-radius:12; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-border-radius:12;">
                    <columns>
                        <TableColumn fx:id="eventTitleCol"    prefWidth="160" text="Ã‰vÃ©nement"/>
                        <TableColumn fx:id="candLastNameCol"  prefWidth="120" text="Nom"/>
                        <TableColumn fx:id="candFirstNameCol" prefWidth="120" text="PrÃ©nom"/>
                        <TableColumn fx:id="candEmailCol"     prefWidth="200" text="Email"/>
                        <TableColumn fx:id="statusCol"        prefWidth="120" text="Statut"/>
                        <TableColumn fx:id="regDateCol"       prefWidth="150" text="Date Inscription"/>
                    </columns>
                </TableView>

                <!-- Actions bar -->
                <HBox alignment="CENTER_LEFT" spacing="12"
                      style="-fx-background-color:white; -fx-background-radius:10; -fx-border-color:#E4EBF5; -fx-border-width:1; -fx-border-radius:10; -fx-padding:14 18;">
                    <Label text="Statut :" style="-fx-font-size:13px; -fx-font-weight:600; -fx-text-fill:#334155;"/>
                    <ComboBox fx:id="registrationStatusCombo" prefWidth="155" promptText="Nouveau statut"/>
                    <Button onAction="#handleUpdateRegistrationStatus" text="âœ”  Mettre Ã  jour"
                            style="-fx-background-color:#1565C0; -fx-text-fill:white; -fx-font-weight:700; -fx-background-radius:8; -fx-padding:8 18; -fx-cursor:hand;"/>
                </HBox>
            </VBox>

        </StackPane>
    </center>
</BorderPane>
