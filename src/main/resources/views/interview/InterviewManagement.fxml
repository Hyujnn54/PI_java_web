<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
      fx:controller="Controllers.interview.InterviewManagementController"
      spacing="16" style="-fx-background-color: #f8f9fa; -fx-padding: 20;"
      stylesheets="@/styles.css">

    <!-- â”€â”€ Header â”€â”€ -->
    <HBox alignment="CENTER_LEFT" spacing="12">
        <Label text="Mes Entretiens" style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="btnScheduleNew" text="+ Planifier" visible="false" managed="false"
                styleClass="btn-primary" onAction="#handleScheduleNew"/>
    </HBox>

    <!-- â”€â”€ Search + Sort bar (shown per role) â”€â”€ -->
    <VBox fx:id="searchBox" spacing="10" visible="false" managed="false"
          style="-fx-background-color: white; -fx-background-radius: 10; -fx-padding: 14;
                 -fx-effect: dropshadow(gaussian,rgba(0,0,0,0.07),8,0,0,2);">

        <!-- Row 1: criteria + dynamic input -->
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Rechercher par :" style="-fx-font-size: 13px; -fx-text-fill: #495057; -fx-font-weight: 600;"/>

            <ComboBox fx:id="comboSearchCriteria" prefWidth="140"
                      style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>

            <!-- Plain text field (shown for Nom / Lieu) -->
            <TextField fx:id="txtSearchInterview" promptText="Rechercher..."
                       prefWidth="240"
                       style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;-fx-padding:7 12;"/>

            <!-- DatePicker shown for Date criterion -->
            <DatePicker fx:id="dateSearchPicker" prefWidth="160" visible="false" managed="false"
                        style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>

            <!-- ComboBox shown for Mode criterion -->
            <ComboBox fx:id="comboSearchMode" prefWidth="160" visible="false" managed="false"
                      style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>

            <!-- ComboBox shown for Statut criterion -->
            <ComboBox fx:id="comboSearchStatus" prefWidth="180" visible="false" managed="false"
                      style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>

            <Button fx:id="btnSearchInterview" text="ðŸ” Rechercher"
                    style="-fx-background-color:#5BA3F5;-fx-text-fill:white;-fx-font-size:13px;
                           -fx-padding:7 16;-fx-background-radius:8;-fx-cursor:hand;"
                    onAction="#handleSearchInterview"/>
            <Button fx:id="btnClearSearch" text="âœ• Effacer"
                    style="-fx-background-color:#6c757d;-fx-text-fill:white;-fx-font-size:13px;
                           -fx-padding:7 14;-fx-background-radius:8;-fx-cursor:hand;"
                    onAction="#handleClearSearch"/>
        </HBox>

        <!-- Row 2: sorting -->
        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Trier par :" style="-fx-font-size: 13px; -fx-text-fill: #495057; -fx-font-weight: 600;"/>
            <ComboBox fx:id="comboSortBy" prefWidth="180"
                      style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>
            <ComboBox fx:id="comboSortDir" prefWidth="120"
                      style="-fx-background-radius:8;-fx-border-radius:8;-fx-border-color:#dee2e6;-fx-border-width:1;"/>
            <Button text="â†• Appliquer"
                    style="-fx-background-color:#3d5a80;-fx-text-fill:white;-fx-font-size:13px;
                           -fx-padding:7 14;-fx-background-radius:8;-fx-cursor:hand;"
                    onAction="#handleApplySort"/>
        </HBox>
    </VBox>

    <!-- â”€â”€ Interview Cards Container â”€â”€ -->
    <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS"
                style="-fx-background: transparent; -fx-background-color: transparent;">
        <VBox fx:id="interviewsListContainer" spacing="16">
            <padding><Insets bottom="10"/></padding>
        </VBox>
    </ScrollPane>

    <!-- â”€â”€ Bottom Action Buttons (recruiter) â”€â”€ -->
    <HBox fx:id="bottomActionButtons" spacing="12" alignment="CENTER_RIGHT"
          visible="false" managed="false" style="-fx-padding: 10 0 0 0;">
        <Button fx:id="btnUpdate" text="âœ Modifier" styleClass="btn-primary" onAction="#handleUpdateInterview"/>
        <Button fx:id="btnDelete" text="ðŸ—‘ Supprimer" styleClass="btn-danger"  onAction="#handleDeleteInterview"/>
    </HBox>

    <!-- â”€â”€ Feedback Panel â”€â”€ -->
    <VBox fx:id="feedbackPanel" visible="false" managed="false" spacing="15"
          style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 25;
                 -fx-effect: dropshadow(gaussian,rgba(0,0,0,0.15),20,0,0,5);">

        <Label text="Retour d'Entretien" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

        <GridPane hgap="15" vgap="15">
            <columnConstraints>
                <ColumnConstraints minWidth="130" prefWidth="130"/>
                <ColumnConstraints/>
            </columnConstraints>
            <Label text="Decision:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="info-label"/>
            <ComboBox fx:id="comboFeedbackDecision" prefWidth="200" GridPane.columnIndex="1" GridPane.rowIndex="0"
                      styleClass="dialog-input" promptText="Selectionner decision"/>

            <Label text="Score Global:" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="info-label"/>
            <HBox spacing="10" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="1">
                <TextField fx:id="txtFeedbackScore" promptText="0-100" prefWidth="100" styleClass="dialog-input"/>
                <Label fx:id="lblScoreIndicator" style="-fx-font-size: 12px; -fx-font-weight: 600;"/>
            </HBox>

            <Label text="Commentaires:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="info-label"/>
            <TextArea fx:id="txtFeedbackComments" promptText="Entrez les commentaires..."
                      GridPane.columnIndex="1" GridPane.rowIndex="2"
                      styleClass="dialog-input" prefRowCount="5" wrapText="true"/>
        </GridPane>

        <HBox spacing="15" alignment="CENTER_RIGHT" style="-fx-padding: 10 0 0 0;">
            <Button fx:id="btnUpdateFeedbackAction" text="Mettre a Jour" styleClass="btn-primary" onAction="#handleUpdateFeedbackAction"/>
            <Button fx:id="btnDeleteFeedback" text="Supprimer" styleClass="btn-danger"
                    onAction="#handleDeleteFeedback" visible="false" managed="false"/>
            <Button fx:id="btnCancelFeedback" text="Annuler" styleClass="btn-secondary" onAction="#handleCancelFeedback"/>
        </HBox>
    </VBox>

    <!-- â”€â”€ Edit Dialog â”€â”€ -->
    <VBox fx:id="editDialog" visible="false" managed="false" spacing="15"
          style="-fx-background-color: white; -fx-background-radius: 12; -fx-padding: 25;
                 -fx-effect: dropshadow(gaussian,rgba(0,0,0,0.15),20,0,0,5);">

        <Label text="Details de l'Entretien" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

        <GridPane hgap="15" vgap="15">
            <columnConstraints>
                <ColumnConstraints minWidth="120" prefWidth="120"/>
                <ColumnConstraints/>
            </columnConstraints>

            <Label text="Date et Heure:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="info-label"/>
            <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="0">
                <DatePicker fx:id="datePicker" prefWidth="160" styleClass="dialog-input"/>
                <TextField fx:id="txtTime" promptText="HH:mm" prefWidth="80" styleClass="dialog-input"/>
            </HBox>

            <Label text="Duree (min):" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="info-label"/>
            <TextField fx:id="txtDuration" promptText="ex: 60" prefWidth="100"
                       GridPane.columnIndex="1" GridPane.rowIndex="1" styleClass="dialog-input"/>

            <Label text="Mode:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="info-label"/>
            <ComboBox fx:id="comboMode" prefWidth="200"
                      GridPane.columnIndex="1" GridPane.rowIndex="2" styleClass="dialog-input"/>

            <Label fx:id="lblMeetingLink" text="Lien Reunion:" GridPane.columnIndex="0" GridPane.rowIndex="3" styleClass="info-label"/>
            <HBox spacing="6" alignment="CENTER_LEFT" GridPane.columnIndex="1" GridPane.rowIndex="3" fx:id="meetingLinkBox">
                <TextField fx:id="txtMeetingLink" promptText="Cliquez sur Generer..."
                           prefWidth="190" styleClass="dialog-input" editable="false"/>
                <Button fx:id="btnGenerateMeetingLink" text="Generer" onAction="#handleGenerateMeetingLink"
                        style="-fx-background-color:#28a745;-fx-text-fill:white;-fx-font-weight:bold;
                               -fx-cursor:hand;-fx-padding:6 10;-fx-background-radius:6;"/>
                <Button fx:id="btnOpenMeetingLink" text="Ouvrir" onAction="#handleOpenMeetingLink"
                        style="-fx-background-color:#5BA3F5;-fx-text-fill:white;-fx-font-weight:bold;
                               -fx-cursor:hand;-fx-padding:6 10;-fx-background-radius:6;"
                        visible="false" managed="false"/>
            </HBox>

            <Label fx:id="lblLocation" text="Lieu:" GridPane.columnIndex="0" GridPane.rowIndex="4" styleClass="info-label"/>
            <TextField fx:id="txtLocation" promptText="Adresse du bureau"
                       GridPane.columnIndex="1" GridPane.rowIndex="4" styleClass="dialog-input"/>

            <Label text="Notes:" GridPane.columnIndex="0" GridPane.rowIndex="5" styleClass="info-label"/>
            <TextArea fx:id="txtNotes" promptText="Notes supplementaires..."
                      GridPane.columnIndex="1" GridPane.rowIndex="5" styleClass="dialog-input" prefRowCount="3"/>

            <TextField fx:id="txtApplicationId" visible="false" managed="false"/>
            <TextField fx:id="txtRecruiterId"   visible="false" managed="false"/>
            <ComboBox  fx:id="comboStatus"       visible="false" managed="false"/>
        </GridPane>

        <HBox spacing="10" alignment="CENTER_RIGHT">
            <Button text="Annuler" onAction="#handleCancelEdit" styleClass="btn-secondary"/>
            <Button fx:id="btnSave" text="Enregistrer" onAction="#handleSaveInterview" styleClass="btn-primary"/>
        </HBox>
    </VBox>

</VBox>

