<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Pane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.StackPane?>

<BorderPane xmlns="http://javafx.com/javafx/8.0.171" xmlns:fx="http://javafx.com/fxml/1" fx:controller="controllers.RecruiterDashboardController" stylesheets="@../style/modern.css">
   <top>
      <HBox styleClass="top-bar" alignment="CENTER_RIGHT" spacing="15.0">
         <children>
            <VBox alignment="CENTER_RIGHT">
               <children>
                  <Label fx:id="userNameLabel" text="User Name" styleClass="user-name" />
                  <Label fx:id="userRoleLabel" text="ROLE" styleClass="badge-role" />
               </children>
            </VBox>
            <Button text="ðŸ‘¤" styleClass="profile-button" />
         </children>
         <padding>
            <Insets left="30.0" right="30.0" top="10.0" bottom="10.0" />
         </padding>
      </HBox>
   </top>
   <left>
      <VBox styleClass="sidebar" prefWidth="250.0" BorderPane.alignment="CENTER">
         <children>
            <Label text="Talent Bridge" styleClass="sidebar-title">
               <graphic>
                  <!-- You can add an ImageView here if you have an icon -->
               </graphic>
            </Label>
            
            <Label text="MENU" styleClass="sidebar-section-label" />
            <Button fx:id="interviewsBtn" text="ðŸ‘¥  Interviews" onAction="#goToInterviews" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT" />
            <Button fx:id="eventsBtn" text="ðŸ“…  Events" onAction="#goToEvents" styleClass="sidebar-button-active" maxWidth="Infinity" alignment="CENTER_LEFT" />
            <Button text="ðŸ‘¤  Candidates (Mock)" onAction="#goToCandidateView" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT" />
            
            <Label text="OTHERS" styleClass="sidebar-section-label">
               <VBox.margin>
                  <Insets top="20.0" />
               </VBox.margin>
            </Label>
            <Button text="âš™ï¸  Settings" onAction="#goToSettings" styleClass="sidebar-button" maxWidth="Infinity" alignment="CENTER_LEFT" />
            
            <Pane VBox.vgrow="ALWAYS" /> <!-- Spacer -->
            
            <Button text="Fullscreen" styleClass="sidebar-bottom-button" maxWidth="Infinity">
               <VBox.margin>
                  <Insets bottom="20.0" left="20.0" right="20.0" />
               </VBox.margin>
            </Button>
         </children>
      </VBox>
   </left>
   
   <center>
      <BorderPane styleClass="content-area">
         <center>
            <javafx.scene.layout.StackPane>
                <children>
                    <!-- Events View -->
                    <VBox fx:id="eventsView" spacing="20.0">
                        <padding>
                            <Insets top="20.0" right="30.0" bottom="20.0" left="30.0" />
                        </padding>
                        <children>
                            <HBox alignment="CENTER_LEFT" spacing="20.0">
                                <children>
                                    <Label text="Ã‰vÃ©nements Disponibles" styleClass="page-title" />
                                    <TextField fx:id="searchField" prefWidth="250.0" promptText="Rechercher par titre..." styleClass="modern-search-field" />
                                    <ComboBox fx:id="typeFilterCombo" prefWidth="150.0" promptText="Type..." styleClass="modern-combo-box" />
                                    <Pane HBox.hgrow="ALWAYS" />
                                    <Button text="RafraÃ®chir" onAction="#refreshTable" styleClass="btn-secondary" />
                                </children>
                            </HBox>
                            
                            <ScrollPane fitToHeight="true" minHeight="300.0" prefHeight="350.0" vbarPolicy="NEVER" styleClass="modern-scroll-pane" VBox.vgrow="ALWAYS">
                                <content>
                                    <HBox fx:id="eventsHBox" spacing="20.0" styleClass="events-container" alignment="CENTER_LEFT" />
                                </content>
                            </ScrollPane>

                            <!-- Form Container -->
                            <VBox fx:id="formContainer" spacing="15.0" styleClass="card">
                                <children>
                                    <Label text="GÃ©rer l'Ã©vÃ©nement" styleClass="section-title"/>
                                    
                                    <!-- Row 1: Title and Type -->
                                    <HBox spacing="15.0">
                                        <children>
                                            <VBox HBox.hgrow="ALWAYS" spacing="5.0">
                                                <children>
                                                    <Label text="Titre de l'Ã©vÃ©nement" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <TextField fx:id="titleField" promptText="Ex: Forum de recrutement IT" styleClass="modern-text-field" />
                                                    <Label fx:id="titleErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                            <VBox spacing="5.0">
                                                <children>
                                                    <Label text="CatÃ©gorie" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <ComboBox fx:id="typeCombo" prefWidth="200.0" promptText="Choisir..." styleClass="modern-combo-box" />
                                                    <Label fx:id="typeErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                            <VBox fx:id="meetLinkContainer" managed="false" visible="false" spacing="5.0" HBox.hgrow="ALWAYS">
                                                <children>
                                                    <Label text="Lien de la rÃ©union (Meet/Zoom)" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <TextField fx:id="meetLinkField" promptText="https://meet.google.com/..." styleClass="modern-text-field" />
                                                    <Label fx:id="meetLinkErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                        </children>
                                    </HBox>
                                    
                                    <!-- Row 2: Location, Date, Time, Capacity -->
                                    <HBox spacing="15.0" alignment="BOTTOM_LEFT">
                                        <children>
                                            <VBox HBox.hgrow="ALWAYS" spacing="5.0">
                                                <children>
                                                    <Label text="Lieu" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <HBox spacing="8.0" alignment="CENTER_LEFT">
                                                        <children>
                                                            <TextField fx:id="locationField" promptText="Ville ou en ligne" styleClass="modern-text-field" HBox.hgrow="ALWAYS" />
                                                            <Button text="ðŸ“" onAction="#handleChooseOnMap" styleClass="btn-secondary" />
                                                        </children>
                                                    </HBox>
                                                    <Label fx:id="locationErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                            <VBox spacing="5.0">
                                                <children>
                                                    <Label text="Date" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <DatePicker fx:id="dateField" prefWidth="140.0" styleClass="modern-date-picker" />
                                                    <Label fx:id="dateErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                            <VBox spacing="5.0">
                                                <children>
                                                    <Label text="Heure" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <HBox spacing="5.0" alignment="CENTER_LEFT">
                                                        <children>
                                                            <ComboBox fx:id="hourCombo" prefWidth="75.0" styleClass="modern-combo-box" />
                                                            <Label text=":" style="-fx-font-weight: bold; -fx-text-fill: #64748b;" />
                                                            <ComboBox fx:id="minuteCombo" prefWidth="75.0" styleClass="modern-combo-box" />
                                                        </children>
                                                    </HBox>
                                                    <Label fx:id="timeErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                            <VBox spacing="5.0">
                                                <children>
                                                    <Label text="CapacitÃ©" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <TextField fx:id="capacityField" prefWidth="80.0" promptText="Nb" styleClass="modern-text-field" />
                                                    <Label fx:id="capacityErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                                </children>
                                            </VBox>
                                        </children>
                                    </HBox>

                                    <VBox spacing="5.0">
                                        <children>
                                            <HBox alignment="CENTER_LEFT" spacing="10.0">
                                                <children>
                                                    <Label text="Description dÃ©taillÃ©e" styleClass="sidebar-section-label" style="-fx-text-fill: #475569;" />
                                                    <Pane HBox.hgrow="ALWAYS" />
                                                    <Button fx:id="aiGenerateBtn" text="âœ¨ IA GÃ©nÃ©rer" onAction="#handleAIGenerate" styleClass="btn-secondary" style="-fx-font-size: 10px; -fx-padding: 3 8;" />
                                                </children>
                                            </HBox>
                                            <TextArea fx:id="descriptionField" prefHeight="80.0" promptText="DÃ©tails de l'Ã©vÃ©nement..." styleClass="modern-text-area" wrapText="true" />
                                            <Label fx:id="descriptionErrorLabel" managed="true" minHeight="0" styleClass="error-label" />
                                        </children>
                                    </VBox>
                                    
                                    <!-- Action Buttons -->
                                    <HBox spacing="10.0" alignment="CENTER_RIGHT">
                                        <children>
                                            <Button mnemonicParsing="false" onAction="#handleClear" text="Vider" styleClass="btn-secondary" />
                                            <Pane HBox.hgrow="ALWAYS" />
                                            <Button mnemonicParsing="false" onAction="#handleDelete" text="Supprimer" styleClass="btn-danger" />
                                            <Button mnemonicParsing="false" onAction="#handleUpdate" text="Modifier" styleClass="btn-warning" />
                                            <Button mnemonicParsing="false" onAction="#handleAdd" text="Ajouter l'Ã©vÃ©nement" styleClass="btn-primary" />
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>
                        </children>
                    </VBox>

                    <!-- Interviews View -->
                    <VBox fx:id="interviewsView" spacing="20.0" visible="false" managed="false">
                        <padding>
                            <Insets top="20.0" right="30.0" bottom="20.0" left="30.0" />
                        </padding>
                        <children>
                            <HBox alignment="CENTER_LEFT" spacing="10.0">
                                <children>
                                    <Label text="Inscriptions / Postulants" styleClass="page-title" />
                                    <Pane HBox.hgrow="ALWAYS" />
                                    <Button text="RafraÃ®chir" onAction="#goToInterviews" styleClass="btn-secondary" />
                                </children>
                            </HBox>

                            <!-- Live Statistics Dashboard -->
                            <HBox fx:id="statsContainer" spacing="20.0" styleClass="stats-container">
                                <children>
                                    <VBox styleClass="stats-card, stats-total" HBox.hgrow="ALWAYS">
                                        <children>
                                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                                <children>
                                                    <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                                        <children>
                                                            <Label fx:id="totalStatsLabel" text="0" styleClass="stats-value" />
                                                            <Label text="Total Postulants" styleClass="stats-label" />
                                                        </children>
                                                    </VBox>
                                                    <Label text="ðŸ‘¥" style="-fx-font-size: 24px;" />
                                                </children>
                                            </HBox>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="stats-card, stats-confirmed" HBox.hgrow="ALWAYS">
                                        <children>
                                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                                <children>
                                                    <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                                        <children>
                                                            <Label fx:id="confirmedStatsLabel" text="0" styleClass="stats-value" />
                                                            <Label text="ConfirmÃ©s" styleClass="stats-label" />
                                                        </children>
                                                    </VBox>
                                                    <Label text="âœ…" style="-fx-font-size: 24px;" />
                                                </children>
                                            </HBox>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="stats-card, stats-pending" HBox.hgrow="ALWAYS">
                                        <children>
                                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                                <children>
                                                    <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                                        <children>
                                                            <Label fx:id="pendingStatsLabel" text="0" styleClass="stats-value" />
                                                            <Label text="En Attente" styleClass="stats-label" />
                                                        </children>
                                                    </VBox>
                                                    <Label text="â³" style="-fx-font-size: 24px;" />
                                                </children>
                                            </HBox>
                                        </children>
                                    </VBox>
                                    <VBox styleClass="stats-card, stats-cancelled" HBox.hgrow="ALWAYS">
                                        <children>
                                            <HBox alignment="CENTER_LEFT" spacing="15.0">
                                                <children>
                                                    <VBox alignment="CENTER_LEFT" HBox.hgrow="ALWAYS">
                                                        <children>
                                                            <Label fx:id="cancelledStatsLabel" text="0" styleClass="stats-value" />
                                                            <Label text="AnnulÃ©s" styleClass="stats-label" />
                                                        </children>
                                                    </VBox>
                                                    <Label text="âŒ" style="-fx-font-size: 24px;" />
                                                </children>
                                            </HBox>
                                        </children>
                                    </VBox>
                                </children>
                            </HBox>
                            <TableView fx:id="attendeesTable" VBox.vgrow="ALWAYS" styleClass="modern-table">
                                <columns>
                                    <TableColumn fx:id="eventTitleCol" prefWidth="150.0" text="Ã‰vÃ©nement" />
                                    <TableColumn fx:id="candLastNameCol" prefWidth="120.0" text="Nom" />
                                    <TableColumn fx:id="candFirstNameCol" prefWidth="120.0" text="PrÃ©nom" />
                                    <TableColumn fx:id="candEmailCol" prefWidth="180.0" text="Email" />
                                    <TableColumn fx:id="statusCol" prefWidth="100.0" text="Statut" />
                                    <TableColumn fx:id="regDateCol" prefWidth="140.0" text="Date Inscr." />
                                </columns>
                            </TableView>
                            <HBox alignment="CENTER_RIGHT" spacing="10.0">
                                <children>
                                    <Label text="Changer Statut:" styleClass="label-header" />
                                    <ComboBox fx:id="registrationStatusCombo" prefWidth="150.0" promptText="Statut" styleClass="modern-combo-box" />
                                    <Button onAction="#handleUpdateRegistrationStatus" styleClass="btn-primary" text="Mettre Ã  jour" />
                                </children>
                                <padding>
                                    <Insets bottom="10.0" left="15.0" right="15.0" top="10.0" />
                                </padding>
                            </HBox>
                        </children>
                    </VBox>
                </children>
            </javafx.scene.layout.StackPane>
         </center>
      </BorderPane>
   </center>
</BorderPane>
